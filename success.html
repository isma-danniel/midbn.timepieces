<!DOCTYPE html>
<html lang="en">
<head>
  <title>Order Successful</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body{
      background:#0d0f10;
      color:#e6e6e6;
      font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial;
      padding:20px;
    }
    .box{
      max-width:520px;
      margin:40px auto;
      background:rgba(255,255,255,.05);
      padding:28px;
      border-radius:20px;
      border:1px solid rgba(220,251,255,.2);
      backdrop-filter:blur(12px);
      -webkit-backdrop-filter:blur(12px);
      box-shadow: 0 18px 55px rgba(0,0,0,.65);
    }
    h2{
      text-align:center;
      color:#DCFBFF;
      margin-bottom:14px;
      letter-spacing:.4px;
    }

    .badge-row{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin: 0 0 16px;
    }
    .badge{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(220,251,255,.22);
      background:rgba(255,255,255,.03);
      color:#DCFBFF;
      opacity:.95;
    }
    .badge.muted{
      color: rgba(230,230,230,.85);
      border-color: rgba(230,230,230,.18);
    }

    .order-id{
      text-align:center;
      font-weight:600;
      margin-bottom:14px;
      opacity:.95;
    }

    .item{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:8px 0;
      border-bottom:1px solid rgba(255,255,255,.08);
      font-size:14px;
    }
    .total{
      text-align:right;
      font-weight:800;
      margin-top:14px;
      color:#DCFBFF;
      letter-spacing:.2px;
    }

    .signature{
      margin-top:18px;
      padding-top:14px;
      border-top:1px solid rgba(255,255,255,.10);
      font-size:14px;
      opacity:.95;
    }
    .note{
      margin-top:10px;
      font-size:12.5px;
      line-height:1.45;
      opacity:.75;
    }
    .note em{
      color:#DCFBFF;
      font-style:normal;
      font-weight:600;
    }

    .btn{
      display:block;
      margin-top:12px;
      text-align:center;
      padding:12px;
      border-radius:30px;
      border:1px solid #DCFBFF;
      color:#DCFBFF;
      text-decoration:none;
      transition:.25s;
      user-select:none;
    }
    .btn:hover{
      background:#DCFBFF;
      color:#000;
    }

    .btn.secondary{
      border:1px solid rgba(220,251,255,.35);
      color:#DCFBFF;
      background:rgba(255,255,255,.03);
    }
    .btn.secondary:hover{
      background:rgba(220,251,255,.12);
      color:#DCFBFF;
    }

    .btn.whatsapp{
      border:1px solid rgba(220,251,255,.45);
      background: linear-gradient(135deg, rgba(78,93,93,.85), rgba(13,15,16,.9));
    }
    .btn.whatsapp:hover{
      box-shadow: 0 0 18px rgba(220,251,255,.25);
      color:#DCFBFF;
      background: linear-gradient(135deg, rgba(78,93,93,1), rgba(13,15,16,1));
    }
  </style>
</head>
<body>

<div class="box">
  <h2>✅ Order Saved</h2>

  <div class="badge-row">
    <div class="badge" id="statusBadge">Status: Pending Verification</div>
    <div class="badge muted" id="paymentBadge" style="display:none;"></div>
  </div>

  <div class="order-id" id="orderId"></div>

  <div id="orderItems"></div>
  <div class="total" id="orderTotal"></div>

  <div class="signature">
    <p><strong>Authorized Initial:</strong> ____________</p>
    <div class="note">
      *Valid upon seller verification and official confirmation.<br>
      To validate your initial, please send this receipt to the seller’s WhatsApp.
      Orders are only confirmed after seller approval.
      <br><br>
      <em>Tip:</em> You may send a screenshot, or use the button below (recommended).
    </div>
  </div>

  <a id="pdfBtn" href="#" target="_blank" class="btn secondary" style="display:none;">View PDF Receipt</a>
  <a id="waBtn" href="#" target="_blank" class="btn whatsapp" style="display:none;">Send to Seller WhatsApp (for valid initial)</a>

  <a href="products.html" class="btn">Continue Shopping</a>
</div>

<script>
  // ✅ Seller WhatsApp (change if needed)
  const SELLER_WA = "6738908960";

  const order = JSON.parse(localStorage.getItem("lastOrder"));

  function esc(str){
    return String(str ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  if(!order){
    document.querySelector(".box").innerHTML = "<h2>No order found</h2>";
  } else {

    // Status (client default)
    const statusText = order.status || "Pending Verification";
    document.getElementById("statusBadge").innerText = "Status: " + statusText;

    // Payment badge (optional)
    if (order.customer && order.customer.payment) {
      const p = document.getElementById("paymentBadge");
      p.innerText = "Payment: " + order.customer.payment;
      p.style.display = "inline-flex";
    }

    document.getElementById("orderId").innerText = "Order ID: " + (order.orderId || "-");

    const container = document.getElementById("orderItems");
    (order.cart || []).forEach(item=>{
      const qty = Number(item.qty || item.quantity || 1);
      const price = Number(item.price || 0);
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <span>${esc(item.name)} (x${qty})</span>
        <span>BND ${(price * qty).toFixed(2)}</span>
      `;
      container.appendChild(div);
    });

    document.getElementById("orderTotal").innerText = "Total: " + (order.total || "BND 0");

    // PDF link
    const pdfUrl = order.pdfUrl || order.receiptPdfUrl || "";
    if (pdfUrl) {
      const pdfBtn = document.getElementById("pdfBtn");
      pdfBtn.href = pdfUrl;
      pdfBtn.style.display = "block";
    }

    // WhatsApp message (professional)
    const msgLines = [
      "Hello MIDBN, I would like to verify my order initial.",
      "",
      "Order ID: " + (order.orderId || "-"),
      "Total: " + (order.total || "BND 0"),
    ];

    if (pdfUrl) msgLines.push("PDF Receipt: " + pdfUrl);

    msgLines.push("");
    msgLines.push("Please confirm and approve my order. Thank you.");

    const waMsg = encodeURIComponent(msgLines.join("\n"));
    const waLink = "https://wa.me/" + SELLER_WA + "?text=" + waMsg;

    const waBtn = document.getElementById("waBtn");
    waBtn.href = waLink;
    waBtn.style.display = "block";

    // optional clear after 2 minutes
    setTimeout(()=> localStorage.removeItem("lastOrder"), 120000);
  }
</script>

</body>
</html>
